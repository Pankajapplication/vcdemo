<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoCrypt · Demo</title>
    <link rel="stylesheet" href="assets/css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="https://www.videocrypt.com/website_assets/css/fonts.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css"
        integrity="sha512-wJgJNTBBkLit7ymC6vvzM1EcSWeM9mmOu+1USHaRBbHkm6W9EgM0HY27+UtUaprntaYQJF75rc8gjxllKs5OIQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/charts/loader.js"></script>
</head>

<body>
    <div class="d-flex min-vh-100 overflow-hidden">
        <aside id="sidebar" class="bg-dark text-white d-flex flex-column">
            <div class="d-flex align-items-center justify-content-between px-3 py-3 border-bottom">
                <span class="logo-text">
                    <img src="assets/img/logo.png" alt="" class="logo">
                </span>
                <button id="toggleBtn" class="btn btn-sm btn-outline-light">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <ul class="nav flex-column mt-2">
                <li class="nav-item">
                    <a href="index.html" class="nav-link d-flex align-items-center text-white px-3">
                        <i class="fas fa-home"></i>
                        <span class="link-text ml-3" title="Analytics Overview">Analytics Overview</span>
                    </a>
                </li>

                <li class="nav-item">
                    <a href="media-player.html" class="nav-link d-flex align-items-center text-white px-3">
                        <!-- <i class="fas fa-chart-line"></i> -->
                        <i class="fas fa-video"></i>
                        <span class="link-text ml-3" title="Media Player">Media Player</span>
                    </a>
                </li>

                <li class="nav-item">
                    <a href="vod.html" class="nav-link d-flex align-items-center text-white px-3 active">
                        <i class="fas fa-users"></i>
                        <span class="link-text ml-3" title="VOD Library">VOD Library</span>
                    </a>
                </li>

                <li class="nav-item">
                    <a href="recommendation.html" class="nav-link d-flex align-items-center text-white px-3">
                        <i class="fas fa-cog"></i>
                        <span class="link-text ml-3" title="Recommendation Engine">Recommendation</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="recommendation.html" class="nav-link d-flex align-items-center text-white px-3">
                        <i class="fas fa-cog"></i>
                        <span class="link-text ml-3" title="Media Assets Management">MAM</span>
                    </a>
                </li>
            </ul>

        </aside>
        <main class="flex-fill dashboard p-4">
            <div class="demo-disclaimer text-secondary text-center mb-4">
                <span>
                    Demo only · All analytics data shown is sample and illustrative
                </span>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="text-white mb-0">VOD Library</h4>
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#VideoFormModal">Upload
                    Video</button>
            </div>
            <div class="container">
                <table>
                    <thead>
                        <tr>
                            <th>Thumbnail</th>
                            <th>Title</th>
                            <th>Genre</th>
                            <th>Duration</th>
                            <th>Views</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td><img src="https://images.unsplash.com/photo-1653045474061-075ba29db54f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzY2ktZmklMjBtb3ZpZSUyMHNjZW5lfGVufDF8fHx8MTc2NjM4NDczMnww&ixlib=rb-4.1.0&q=80&w=1080"
                                    alt="Quantum Horizon" /></td>
                            <td>Quantum Horizon</td>
                            <td><span class="badge-genre badge-sci-fi">Sci-Fi</span></td>
                            <td>2h 15m</td>
                            <td>1.25M</td>
                            <td><span class="badge-published">Published</span></td>
                            <td><span class="actions">&#8942;</span></td>
                        </tr>
                        <tr>
                            <td><img src="https://images.unsplash.com/photo-1653045474061-075ba29db54f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzY2ktZmklMjBtb3ZpZSUyMHNjZW5lfGVufDF8fHx8MTc2NjM4NDczMnww&ixlib=rb-4.1.0&q=80&w=1080"
                                    alt="Eternal Sunset" /></td>
                            <td>Eternal Sunset</td>
                            <td><span class="badge-genre badge-romance">Romance</span></td>
                            <td>1h 45m</td>
                            <td>0.89M</td>
                            <td><span class="badge-published">Published</span></td>
                            <td>
                                <div class="dropdown">
                                    <button class="p-0 m-0 bg-transparent border-0" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <span class="actions m-0">&#8942;</span>
                                    </button>
                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                        <a class="dropdown-item" href="#">Action</a>
                                        <a class="dropdown-item" href="#">Another action</a>
                                        <a class="dropdown-item" href="#">
                                            Details
                                        </a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><img src="https://images.unsplash.com/photo-1653045474061-075ba29db54f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzY2ktZmklMjBtb3ZpZSUyMHNjZW5lfGVufDF8fHx8MTc2NjM4NDczMnww&ixlib=rb-4.1.0&q=80&w=1080"
                                    alt="The Dark Protocol" /></td>
                            <td>The Dark Protocol</td>
                            <td><span class="badge-genre badge-thriller">Thriller</span></td>
                            <td>2h 5m</td>
                            <td>2.15M</td>
                            <td><span class="badge-published">Published</span></td>
                            <td><span class="actions">&#8942;</span></td>
                        </tr>
                        <tr>
                            <td><img src="https://images.unsplash.com/photo-1653045474061-075ba29db54f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzY2ktZmklMjBtb3ZpZSUyMHNjZW5lfGVufDF8fHx8MTc2NjM4NDczMnww&ixlib=rb-4.1.0&q=80&w=1080"
                                    alt="Velocity Strike" /></td>
                            <td>Velocity Strike</td>
                            <td><span class="badge-genre badge-action">Action</span></td>
                            <td>1h 55m</td>
                            <td>1.78M</td>
                            <td><span class="badge-published">Published</span></td>
                            <td><span class="actions">&#8942;</span></td>
                        </tr>
                        <tr>
                            <td><img src="https://images.unsplash.com/photo-1653045474061-075ba29db54f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzY2ktZmklMjBtb3ZpZSUyMHNjZW5lfGVufDF8fHx8MTc2NjM4NDczMnww&ixlib=rb-4.1.0&q=80&w=1080"
                                    alt="Wild Horizons" /></td>
                            <td>Wild Horizons</td>
                            <td><span class="badge-genre badge-documentary">Documentary</span></td>
                            <td>1h 30m</td>
                            <td>0.65M</td>
                            <td><span class="badge-published">Published</span></td>
                            <td><span class="actions">&#8942;</span></td>
                        </tr>
                        <tr>
                            <td><img src="https://images.unsplash.com/photo-1653045474061-075ba29db54f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzY2ktZmklMjBtb3ZpZSUyMHNjZW5lfGVufDF8fHx8MTc2NjM4NDczMnww&ixlib=rb-4.1.0&q=80&w=1080"
                                    alt="The Last Laugh" /></td>
                            <td>The Last Laugh</td>
                            <td><span class="badge-genre badge-comedy">Comedy</span></td>
                            <td>1h 40m</td>
                            <td>1.12M</td>
                            <td><span class="badge-published">Published</span></td>
                            <td><span class="actions">&#8942;</span></td>
                        </tr>
                        <tr>
                            <td><img src="https://images.unsplash.com/photo-1653045474061-075ba29db54f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzY2ktZmklMjBtb3ZpZSUyMHNjZW5lfGVufDF8fHx8MTc2NjM4NDczMnww&ixlib=rb-4.1.0&q=80&w=1080"
                                    alt="The Last Laugh" /></td>
                            <td>The Last Laugh</td>
                            <td><span class="badge-genre badge-comedy">Comedy</span></td>
                            <td>1h 40m</td>
                            <td>1.12M</td>
                            <td><span class="badge-published">Published</span></td>
                            <td><span class="actions">&#8942;</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="demo-disclaimer mt-4 text-center text-secondary">
                <span>
                    Demo only · All analytics data shown is sample and illustrative
                </span>
            </div>
        </main>
    </div>
    <!-- Modal -->
     <iframe src="loader.html" frameborder="0" id="loader"></iframe>
         <!-- Video Player Modal -->
<div class="modal fade" id="videoPlayerModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <video id="modalVideo" controls width="100%"></video>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div id="toast">
    <span class="toastText">Success</span>
</div>
    <div class="modal fade" id="VideoFormModal" tabindex="-1" aria-labelledby="VideoFormModalLabel" aria-hidden="true"
        data-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <form id="form">
                        <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" class="form-control" id="title" placeholder="Video Title">
                        </div>
                        <div class="form-group">
                            <label for="genre">Genre</label>
                            <select class="custom-select" id="category">
                                <option selected value>Select Category</option>
                                <option value="Sci-Fi">Sci-Fi</option>
                                <option value="Romance">Romance</option>
                                <option value="Thriller">Thriller</option>
                                <option value="Action">Action</option>
                                <option value="Documentary">Documentary</option>
                                <option value="Comedy">Comedy</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="uploadVideoFile">Upload Video</label>
                            <input type="file" class="form-control-file" id="uploadVideoFile">
                        </div>
                        <button type="submit" id="submitBtn" class="btn btn-primary w-100 mt-2">Submit</button>
                    </form>
                </div>
                <!-- <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div> -->
            </div>
        </div>
    </div>
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="assets/js/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="assets/js/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <script>
      const videoForm = document.querySelector('#form');
const uploadVideo = document.querySelector('#uploadVideoFile');
const submitBtn = document.querySelector('#submitBtn');
const loader = document.querySelector('#loader');
const tableBody = document.querySelector('#tableBody');

// Utility functions
function showError(el, message) {
    let errorSpan = el.nextElementSibling;
    if (!errorSpan || !errorSpan.classList.contains('error')) {
        errorSpan = document.createElement('span');
        errorSpan.classList.add('error');
        el.insertAdjacentElement('afterend', errorSpan);
    }
    errorSpan.textContent = message;
}

function generateRandomViews() {
    const views = Math.floor(Math.random() * 2000000);
    if (views >= 1000000) return (views / 1000000).toFixed(2) + 'M';
    if (views >= 1000) return (views / 1000).toFixed(1) + 'K';
    return views.toString();
}

function getVideoDuration(file) {
    return new Promise((resolve) => {
        const url = URL.createObjectURL(file);
        const video = document.createElement('video');
        video.preload = 'metadata';
        video.src = url;

        video.onloadedmetadata = () => {
            URL.revokeObjectURL(url);
            const durationSec = video.duration;
            const h = Math.floor(durationSec / 3600);
            const m = Math.floor((durationSec % 3600) / 60);
            const s = Math.floor(durationSec % 60);
            let formatted = '';
            if (h > 0) formatted += h + 'h ';
            if (m > 0 || h > 0) formatted += m + 'm ';
            formatted += s + 's';
            resolve(formatted);
        };
    });
}

function generateThumbnail(file) {
    return new Promise((resolve) => {
        const video = document.createElement('video');
        video.preload = 'metadata';
        video.src = URL.createObjectURL(file);
        video.muted = true;
        video.currentTime = 1;

        video.onloadeddata = () => {
            const canvas = document.createElement('canvas');
            canvas.width = 160;
            canvas.height = 90;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            resolve(canvas.toDataURL('image/png'));
        };
    });
}

function setupPlayButton(videoFile, playButton) {
    playButton.addEventListener('click', () => {
        const modalVideo = document.getElementById('modalVideo');
        modalVideo.src = URL.createObjectURL(videoFile);
        $('#videoPlayerModal').modal('show');
        modalVideo.play();
    });
}

function validateFile(file) {
    const acceptedFileTypes = ['mp4', 'mkv'];
    const ext = file.name.split('.').pop().toLowerCase();
    const maxSize = 100 * 1024 * 1024;

    if (!acceptedFileTypes.includes(ext)) {
        showError(uploadVideo, `Only ${acceptedFileTypes.join(', ')} files are supported`);
        return false;
    }
    if (file.size > maxSize) {
        showError(uploadVideo, 'File size must be less than 100MB');
        return false;
    }
    showError(uploadVideo, '');
    return true;
}

function setLoading(isLoading) {
    loader.style.display = isLoading ? 'block' : 'none';
    submitBtn.disabled = isLoading;
}

async function addRowToTable(data) {
    const tr = document.createElement('tr');
    const thumbnail = data.file ? await generateThumbnail(data.file) : data.thumbnail;

    tr.innerHTML = `
        <td><img src="${thumbnail}" alt="${data.title}" width="160"/></td>
        <td>${data.title}</td>
        <td><span class="badge-genre badge-${data.category.toLowerCase()}">${data.category}</span></td>
        <td>${data.duration}</td>
        <td>${data.views}</td>
        <td><span class="badge-published">Published</span></td>
        <td>
            <div class="dropdown">
                <button class="p-0 m-0 bg-transparent border-0" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="actions m-0">&#8942;</span>
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item play-btn" href="#">Play</a>
                </div>
            </div>    
        </td>
    `;
    tableBody.prepend(tr);

    const playButton = tr.querySelector('.play-btn');
    if (data.file) setupPlayButton(data.file, playButton);
}

// Load data from localStorage on page load (only metadata + thumbnail)
function loadLocalStorageData() {
    const savedData = JSON.parse(localStorage.getItem('Data')) || [];
    savedData.forEach(d => addRowToTable(d));
    localStorage.removeItem('Data');
}

// Form submission
videoForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const title = document.querySelector('#title').value.trim();
    const category = document.querySelector('#category').value;
    const file = uploadVideo.files[0];

    // Validation
    if (!title || !category || !file || !validateFile(file)) return;

    setLoading(true);

    const duration = await getVideoDuration(file);
    const views = generateRandomViews();

    const data = { title, category, file, duration, views };

    // Optional: store metadata + thumbnail in localStorage
    const thumbnail = await generateThumbnail(file);
    const storageData = { ...data, file: null, thumbnail }; // file cannot go in localStorage
    localStorage.setItem('Data', JSON.stringify([storageData]));

    // Simulate processing
    setTimeout(async () => {
        await addRowToTable(data); // real row with File object for playback
        setLoading(false);
        videoForm.reset();
        $('#VideoFormModal').modal('hide');
        localStorage.removeItem('Data'); // clear
    }, 800);
});

// Load saved rows
loadLocalStorageData();

let toast = document.querySelector('#toast');
document.addEventListener('DOMContentLoaded', function(){
    function toast(status, Error){
        
    }
})
    </script>
</body>

</html>